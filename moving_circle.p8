pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
c = 0.05
normal = 1
frictionmag = c * normal
mapx = 0
count = 0

function v_add(a,b)
	a.x=a.x+b.x
	a.y=a.y+b.y
end

function v_mult(a,length)
	a.x=a.x*length
	a.y=a.y*length
end

function v_len(vector)
	return sqrt(vector.x*vector.x+vector.y*vector.y)
end

function v_normalize(vector)
	local len = v_len(vector)
	if(len > 0) then
		vector.x = vector.x / len
		vector.y = vector.y / len
	end
end

function updateacc(x,y)
	ball.acceleration.x += x
	ball.acceleration.y += y
end

function _init()
	ball = {
		position = {x=64,y=64},
		velocity = {x=0,y=0},
		acceleration = {x=0,y=0},
		friction = {x=0.1,y=0.1},
		magnitude = 0,
		topspeed = 5,
  col = 14,
  size = 3
	}
end

function _update()
	ball.friction.x = ball.velocity.x
	ball.friction.y = ball.velocity.y
	v_mult(ball.friction,-1)
	--normalize doesn't seem to work (may not be necessary)
	--ball.friction = v_normalize(ball.friction)
	v_mult(ball.friction,frictionmag)
	v_add(ball.acceleration,ball.friction)
	v_add(ball.velocity,ball.acceleration)
	v_add(ball.position,ball.velocity)


if(ball.position.x<0) then
	ball.position.x=0
	ball.velocity.x=ball.velocity.x*-1
	ball.col = 7
	ball.size = 2
	--frictionmag=frictionmag*-1
elseif(ball.position.x>125) then
	ball.position.x=125
	ball.velocity.x=ball.velocity.x*-1
	ball.col = 7
	ball.size = 2
	--frictionmag=frictionmag*-1
end
if(ball.position.y<0) then
	ball.position.y=0
	ball.velocity.y=ball.velocity.y*-1
	ball.col = 7
	ball.size = 2
	--frictionmag=frictionmag*-1
elseif(ball.position.y>125) then
	ball.position.y=125
	ball.velocity.y=ball.velocity.y*-1
	ball.col = 7
	ball.size = 2
	--frictionmag=frictionmag*-1
end	

	v_mult(ball.acceleration,0)
end

function _draw()
	rectfill(0,0,127,127,5)
	map(mapx,0,0,0)
	count += 1
	if (count % 5 == 0) then
 	mapx += 16
 	if mapx > 48 then
 		mapx = 0
 	end
	end
	
	circfill(ball.position.x,ball.position.y,ball.size,ball.col)
	ball.col = 14
	ball.size = 3

	if (btn(0)) then updateacc(-0.51,0) end
	if (btn(1)) then updateacc(0.5,0) end
	if (btn(2)) then updateacc(0,-0.5) end
	if (btn(3)) then updateacc(0,0.5) end

	print("x "..tostr(ball.velocity.x),0,115)
	print("y "..tostr(ball.velocity.y),0,123)
end
__gfx__
00000000dddddddd0000000000000000000000009090909000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000009999000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700dddddddd0000000000999900099999909999999000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000dddddddd0009900000999900099999900999999900000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000dddddddd0009900000999900099999909999999000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700dddddddd0000000000999900099999900999999900000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000009999009999999000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000000000000909090900000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000010101010101010101010101010100010101010101010101010101010101010100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101010101010101010101000000010101010101010101010101010100010100000000000000000000000001010100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101010101010101010101000000010100000000000000000000010100010100000000000000000000000001010100000101010101010101010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000000000000000101000000010100000000000000000000010100010100000101010101010101000001010100000101010101010101010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000000000000000101000000010100000101010101010000010100010100000101010101010101000001010100000101000000000000010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000101010100000101000000010100000101010101010000010100010100000101000000000101000001010100000101000000000011010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000101010100000101000000010100000101000001010000010100010100000101000000000101000001010100000101000001010011010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000101010100000101000000010100000101000001010000010100010100000101000000000101000001010100000101110001010011010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000101010100000101000000010100000101010101010000010100010100000101000000000101000001010100000101110000000000010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000000000000000101000000010100000101010101010000010100010100000101010101010101000001010100000101000000000000010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010100000000000000000101000000010100000000000000000000010100010100000101010101010101000001010100000101010101010101010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101010101010101010101000000010100000000000000000000010100010100000000000000000000000001010100000101010101010101010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101010101010101010101000000010101010101010101010101010100010100000000000000000000000001010100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000010101010101010101010101010100010101010101010101010101010101010100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
